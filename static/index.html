<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Simple Chat</title>
  <style>
    #messages { height: 400px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px; }
    input, textarea { width: 100%; }
  </style>
</head>
<body>
  <h1>Simple Chat</h1>
  <div id="messages"></div>
  
  <!-- ãƒ•ã‚¡ã‚¤ãƒ«é€ä¿¡ -->
  <form id="uploadForm">
    <input type="file" id="fileInput" />
    <button type="submit">é€ä¿¡ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ï¼‰</button>
  </form>

  <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ -->
  <textarea id="messageInput" rows="2" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ï¼ˆEnterã§é€ä¿¡ã€Shift+Enterã§æ”¹è¡Œï¼‰"></textarea>

  <script>
    const ws = new WebSocket("wss://" + location.host + "/ws");
    const messages = document.getElementById("messages");
    const input = document.getElementById("messageInput");

    ws.onmessage = function(event) {
      const message = document.createElement("div");
      if (event.data.startsWith("FILE:")) {
        const [_, filename] = event.data.split(":", 2);
        message.innerHTML = `ğŸ“ <a href="/files/${filename}" target="_blank">${filename}</a>`;
      } else {
        message.textContent = event.data;
      }
      messages.appendChild(message);
      messages.scrollTop = messages.scrollHeight;
    };

    // Enterã§é€ä¿¡ã€Shift+Enterã§æ”¹è¡Œ
    input.addEventListener("keydown", function(e) {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        const text = input.value.trim();
        if (text) {
          ws.send(text);
          input.value = "";
        }
      }
    });

    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
    document.getElementById("uploadForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const file = document.getElementById("fileInput").files[0];
      if (!file) return;
      const formData = new FormData();
      formData.append("file", file);

      fetch("/upload", { method: "POST", body: formData })
        .then(res => res.text())
        .then(filename => {
          ws.send("FILE:" + filename);
        });
    });
  </script>
</body>
</html>
